//
//  Instruction.swift
//  KaiKai
//
//  Created by 山口翔生 on 2025/04/30.
//

import SwiftUI
import AVKit

struct Instruction: View {
        var body: some View {
            ScrollView {
                VStack(alignment: .leading, spacing: 20) {

                    Text("写真スポットクイズを用いた、旅行中の楽しさを向上させるシステムの提案")
                        .font(.title)
                        .fontWeight(.bold)
                        .foregroundColor(.blue)

                    Text("はじめに")
                        .font(.title2)
                        .fontWeight(.semibold)
                        .foregroundColor(.purple)

                    Text("本日は本実験にご協力いただき、誠にありがとうございます。本実験は、旅行中の楽しさやポジティブな感情の向上を目的として実施します。具体的には、3人1組のグループで、特定の観光スポット内にある『写真スポット』を協力して探索していただき、その過程でグループ内のコミュニケーションが活発になるか、そしてそれが旅行体験にどのような影響を与えるかを調査します。クイズは、観光スポット内にある特定の『写真スポット』の一部を切り取った画像として出題されます。被験者の皆さんには、そのスポットを見つけた際に同様の写真を撮っていただきます。")

                    Text("本実験では比較のため、以下の2つの条件で実施していただきます。\n① 写真スポットシステムを使用しない場合\n② 写真スポットシステムを使用する場合")

                    Text("実施は2日間にわたり行い、各日ごとに上記のいずれかの条件で実験を行います。すべての実験は16時までに完了していただきますよう、お願いいたします。当日は京都市内に集合していただき、まず全員に簡単な性格診断テストを受けていただきます。診断が終了した後、あらかじめ用意した18のスポットの中から1か所目の訪問先をグループで選び、移動していただきます。")

                    Text("各スポットでは、以下の流れで実験を進めていただきます。\n1. スポット到着後、『スポット到着時アンケート』に回答\n2. ①の場合：そのまま自由に観光し、約7分後に『途中アンケート』に回答\n　②の場合：指定された写真スポットを探索し、発見後に『途中アンケート』に回答\n3. その後もスポット内で自由に行動可能\n4. スポットを退出する際に、『スポット退出時アンケート』に回答\n5. 次のスポットを決定し、同様の手順を繰り返す（1日3スポットまで）")

                    Text("休憩はスポット間の移動時など、適宜お取りいただいて構いません。実験の進行・連絡はMicrosoft Teams上で行います。不明点がありましたら、お手数ですが下記の連絡先までお問い合わせください。")

                    Text("※Apple Watchは研究側で貸与します。参加当日、各自に貸与されたApple Watchとスマートフォンを装着していただきます。操作はスタッフが案内いたしますが、不安がある場合はTeamsでご連絡ください。")
                        .foregroundColor(.red)
                    
                    Text("※写真スポットクイズの場所であったりヒントをネットで検索して探しては行けません。")
                        .foregroundColor(.red)

                    Text("※アンケートはGoogle Formにて実施します。通信環境が必要となるため、可能な限り電波状況の良い場所でご回答ください。通信トラブルによる再送信ややり直しは原則対応しておりません。")
                        .foregroundColor(.red)

                    Text("※実験中の連絡はMicrosoft Teamsを通じて行います。その他の緊急連絡手段は用意していないため、Teamsの通知確認を必ず行ってください。")
                        .foregroundColor(.red)

                    Text("※アンケート回答や心拍数の計測が行えなかった場合でも、再実施・再送信は行いません。記録が欠落した場合、そのスポットのデータは無効となる可能性がありますので、各自での確認を徹底してください。")
                        .foregroundColor(.red)

                    Text("※実験参加前には、同意書にご署名いただきます。取得するデータには、心拍数や性格診断（BIG5尺度に基づく）などが含まれます。これらのデータは匿名化された上で研究目的のみに使用されます。分析手法については今後の研究計画に基づいて確定予定です。")
                        .foregroundColor(.red)

                    Text("<実験前の準備>")
                        .font(.title3)
                        .fontWeight(.semibold)
                        .foregroundColor(.purple)

                    Text("• Microsoft Teamsにて、ユーザーごとに個別で連絡を行います。\n• 動きやすい格好で参加してください。\n• 不明点や不安な点がある場合は、事前に研究担当者にご連絡ください。")

                    Text("実験手順書")
                        .font(.title2)
                        .fontWeight(.semibold)

                    Text("<実験内容>\n本実験では、1日の旅行中に3人1組のグループで観光スポットを巡っていただきます。その際に、写真スポットクイズシステムを用いる場合と用いない場合の2条件（各1日ずつ、合計2日間）で比較実験を実施し、グループ内のコミュニケーションの活性度や旅行中のポジティブな感情の変化について調査を行います。当日は、京都市内にてグループで集合していただき、以下の流れで実験を進めます。すべての行程は16時までに終了していただく必要があります。")

                    Text("<手順1：性格診断の実施（実験開始前）>\n京都市内でグループ集合後、まずは各個人にそれぞれスマートフォンとApple Watchをつけていただきます。そして簡単な性格診断テストをグループ全員に受けていただきます。これにより、性格傾向に基づいた感情の変化等の分析を可能にします。")

                    Text("<手順2：スポットの選定と移動>\n性格診断終了後、研究側が用意した18の観光スポット候補の中から、グループで話し合って最初に訪れるスポットを1つ決定し、移動していただきます。移動手段は各自で調べていただきます。\nグループでの話し合いは、全員の意見を尊重し、合意形成を目的として行なってください。")

                    Text("<手順3：スポット到着後のアンケート回答とApple Watchの心拍数計測開始>\nスポット到着後(スポットの看板や入口がはっきりと見える場所に到着した時点を『スポット到着とする』)、以下のアンケートに回答していただきます。\n• 『スポット到着時アンケート』\nまた、同時にApple Watchの心拍数計測アプリを開いてもらい計測を開始してもらいます。\n名前入力の際には、Iphoneと連携してiphone側でキーボードを開けれるようになっています。\n図１：アプリのアイコン\n・下図のアプリを開いてもらい計測開始を押してもらいます。少し時間が経って、経過時間が進んでいるかどうか確認してもらいます。")
                    Image("Image")
                        .resizable()
                        .scaledToFit()
                        .cornerRadius(10)

                    Text("<手順4：写真スポットクイズの有無に応じた行動>\n• 条件①：クイズシステムなし\nそのまま自由に観光を行っていただきます。約7分後に『途中アンケート（写真スポットに関する印象など）』に回答してください。\n• 条件②：クイズシステムあり\n出題された写真スポットクイズに挑戦し、協力して該当スポットを探索していただきます。発見後、途中アンケートに回答していただきます。\nアンケート回答後も、スポット内では自由に過ごして構いません。")

                    Text("<手順5：スポット退出時アンケートとApple Watchの心拍数計測停止>\nスポットを退出する際には、以下のアンケートに回答していただきます。\n• 『スポット退出時アンケート』\nApple Watchの計測アプリを開いて、終了ボタンを押していただき、完了ボタンを押してもらうことで心拍数計測を終了してもらいます。\n• 終了できていることが確認できたらサイドボタンを2回押してもらいアプリを横にスライドしてもらうことで、アプリを終了してもらいます。(以下動画に示す)")
                    
                    if let url = Bundle.main.url(forResource: "watch_demo", withExtension: "MP4") {
                                       VideoPlayer(player: AVPlayer(url: url))
                                           .frame(height: 300)
                                           .cornerRadius(12)
                                           .padding(.horizontal)
                                   } else {
                                       Text("動画ファイルが見つかりません")
                                           .foregroundColor(.red)
                                   }

                    Text("<手順6：次のスポットの選定と移動>\n次に訪問するスポットをグループで選定し、上記と同様の流れを繰り返します。1日の中で合計3か所のスポットを訪問していただきます。")

                    Text("<その他の注意事項>\n• 移動中に休憩を取ることは自由です。\n• アンケートの送信後は、そのタブを閉じてください。\n• 実験に関する連絡やサポートはTeams上で行います。通知設定をオンにしておいてください。\n• リマインドメッセージもTeams経由で送信しますが、リマインドに関係なく各アンケートには必ず回答をお願いします。")

                    Text("ご不明な点がある場合は、研究担当までお気軽にご連絡ください。\n\n京都産業大学　情報理工学部\nKidsLab.　4年　255053 山口　翔生\nMail: g2255053@cc.kyoto-su.ac.jp")
                }
                .padding()
                .textSelection(.enabled)
            }
        }
}
